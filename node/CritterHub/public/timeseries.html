<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/vendor/c3.css">
  </head>
  <body>
    <div id="chart"></div>

    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="js/vendor/c3.js"></script>
    <script>

		var columns = [
			['x'],
			['temp'],
			['humidity']
		];
	
		var chart = c3.generate({
			bindto: '#chart',
			data: {
				x : 'x',
				xFormat : '%Y%m%d',
				axes: {
				            temp: 'y',
				            humidity: 'y2'
				        },
				columns: columns
			},
			axis : {
				x : {
					type : 'timeseries',
					tick : {
						//              format : "%m/%d" // https://github.com/mbostock/d3/wiki/Time-Formatting#wiki-format
						format : "%Y-%m-%dT%H:%M:%S", // https://github.com/mbostock/d3/wiki/Time-Formatting#wiki-format
						culling: {
						                    max: 4 // the number of tick texts will be adjusted to less than this value
						                }
					}
				}
			}
		});
	
		/*
		setInterval(function() {
			addData('sample', Math.random() * 2000);
		}, 1009);
*/

		function addData(columnName, value) {
			var xSeries, series;
			function findEle(keyToMatch) {
				var key, foundEle;
				columns.forEach(function(ele) {
					key = ele[0];
					if (key === keyToMatch) { foundEle = ele; }
				});
				return foundEle;
			}
			series = findEle(columnName);
			//console.log('series', series);
			series.push(value);

			xSeries = findEle('x');
			//console.log('xSeries', xSeries);
			xSeries.push(new Date());

			//console.log('columns', columns);
			chart.load({ columns: columns });

		}
		
    </script>

	<script src="js/socket.io-1.3.5.js"></script>
	
	<script>

		'use strict';

		function initSocket() {
			console.log('init');
			var socket = io('http://localhost:3000');

			socket.on('connect', function() {
				console.log('connect');
				socket.on('disconnect', function() {
					console.log('disconnect');
				});
				socket.on('data', function (data) {
					console.log(data.temp);
					if (data.temp !== undefined) {
						addData('temp', data.temp);
					}
				});
			});
		}
		initSocket();

	</script>

  </body>
</html>
